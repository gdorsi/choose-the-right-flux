<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Choose the right Flux</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">
    <link rel="stylesheet" href="dist/index.css">
	</head>
	<body>
		<section class="active">
			<h1>Choose the right Flux!</h1>
			<p>
				In a kingdom rich of async calls and complexity,
				only the right hero can bring peace and scalability.
			</p>
			<p>
				Flux can be the right choice, but there are hundreds implementations and we must choose the right one.
			</p>
			<div class="bottom-left">
				Guido D'Orsi @ RomaJS
			</div>
		</section>
		<section>
			<h3>
				Once upon a time...
			</h3>
		</section>
		<section>
			<h3>
				Web applications were static
			</h3>
		</section>
		<section>
			<h3>
				Javascript was usless and hated by anyone
			</h3>
		</section>
		<section>
			<h3>
				One day web applications becomes dynamic...
			</h3>
		</section>
		<section>
			<h4>
				...but develop in Javascript was still a pain...
			</h4>
		</section>
		<section>
			<h4>
				...So the community start to create amazing tools (and polyfills)...
			</h4>
		</section>
		<section>
			<h4>
				...and develop web applications starts to become fancy...
			</h4>
		</section>
		<section>
			<h2>...someone starts to use MVC...</h2>
			<img src="img/mvc-simple.png"class="responsive halfscreen">
		</section>
		<section>
			<h2>...But it does not scale!</h2>
			<img src="img/mvc-facebook.png" class="responsive halfscreen">
		</section>
		<section>
			<h4>
				A dynamic web app should be able
				to change over time
			</h4>
		</section>
		<section>
			<h3>
				So?
			</h3>
			<h4 class="fragment">
				Should be PREDICTABLE
			</h4>
		</section>
		<section>
			<h2>So Facebook creates Flux</h2>
			<img src="img/flux.png" class="responsive halfscreen">
		</section>
		<section>
			<h2>Unidirectional data flow</h2>
			<img src="img/happy.gif" class="responsive halfscreen">
		</section>
		<section>
			<img src="img/flux-explained.png" class="responsive fullscreen">
		</section>
		<section>
			<h3>Let's search the best implementation</h3>
		</section>
		<section>
			<div class="item-set">
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/facebook-flux">Facebook Flux</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/yahoo-fluxible">Fluxible by Yahoo</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/reflux">Reflux</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/alt">Alt</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/flummox">Flummox</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/marty">Marty.js</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-samples/tree/master/mcfly">McFly</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/lux">Lux</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/material-flux">Material Flux</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/redux">Redux</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/nuclear-js">Nuclear.js</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/fluxette">Fluxette</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/fluxxor">Fluxxor</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/freezer-js">Freezer</a></div>
				<div class="task-list-item"><a href="https://github.com/voronianski/flux-comparison/tree/master/fluxury">Fluxury</a></div>
			</div>
			<p>and so many others...</p>
		</section>
		<section>
			<h2>Redux</h2>
			<p>Based on three Principles</p>
			<ul>
				<li>Single source of truth</li>
				<li>State is read-only</li>
				<li>Changes are made with pure functions</li>
			</ul>
		</section>
		<section>
			<h4>Single source of truth</h4>
			<p>"The state of your whole application is stored in an object tree within a single store"</p>
		</section>
		<section>
			<h4>State is read-only</h4>
			<p>"The only way to change the state is to emit an action"</p>
		</section>
		<section>
			<h4>Changes are made with pure functions</h4>
			<p>"To specify how the state tree is transformed by actions, you write pure reducers"</p>
		</section>
		<section>
			<h2>MobX</h2>
			<p>Simple, scalable state management<p>
			<ul>
				<li>Observable</li>
				<li>Mutable data structures</li>
				<li>Data derivation</li>
			</ul>
		</section>
		<section>
			<img src="img/boring.gif" class="responsive fullscreen">
		</section>
		<section>
			<h3>Code demo</h3>
			<h2 class="fragment">This slides!</h2>
		</section>
		<section>
			<h4>
				Actions are object that describes what happened
			</h4>
			<p class="code">
{
	type: 'ADD_TODO',
	data: actionData
}
			</p>
		</section>
		<section>
			<h4>
				Flux Standard Action
			</h4>
			<p class="code">
{
	type: 'ADD_TODO',
	payload: actionData,
	meta: actionMeta
},
{
	type: 'ADD_TODO',
	payload: new Error(),
	error: true
}
			</p>
		</section>
		<section>
			<h4>
				Action creators, creates and dispatch the messages
			</h4>
			<p class="code">
const addTodo = (todo) => {
	dispatch({
		type: 'ADD_TODO',
		payload: todo
	});
};
			</p>
		</section>
		<section>
			<h3>Async actions</h3>
			<p class="code">
const addTodo = (todo) => {
	saveToDoWebApi(todo)
			.then((todo) => {
				dispatch({
					type: 'ADD_TODO',
					payload: todo
				});
			})
			.catch(() => {
				dispatch({
					type: 'ADD_TODO',
					payload: new Error('damn'),
					error: true
				});
			});
};
			</p>
		</section>
		<section>
			<h3>Optimistic updates</h3>
			<p class="code">
const addTodo = (todo) => {
	dispatch({
		type: 'ADD_TODO',
		payload: todo
	});
	saveToDoWebApi(todo)
			.catch(() => {
				dispatch({
					type: 'REMOVE_TODO',
					payload: todo
				});
			});
};
			</p>
		</section>
		<section>
			<h3>Single responsibility</h3>
			<p class="code">
const addTodo = (todo) => ({
	type: 'ADD_TODO',
	payload: todo
});

dispatch(addTodo(myPrettyTodo));
			</p>
		</section>
		<section>
			<h3>Middlewares!</h3>
			<p class="code">
const addTodo = (todo) => ({
	type: 'ADD_TODO',
	payload: saveToDoWebApi(todo)
});

resolvePromise(dispatch, addTodo(myPrettyTodo));
			</p>
		</section>
		<section>
			<h2>Stores</h2>
			<p>The source of truth</p>
		</section>
		<section>
			<p class="code">
{
	"todos": [
		{"value": "banana", "completed:false"},
		{"value": "banana", "completed:false"},
		{"value": "banana", "completed:false"}
	]
}
			</p>
		</section>
		<section>
			<p class="code">
{
	"todos": [
		{"value": "banana", "completed:true"},
		{"value": "banana", "completed:false"},
		{"value": "banana", "completed:false"}
	],
	"completed": 1
}
			</p>
		</section>
		<section>
			<p class="code">
{
	"todos": [
		{"value": "banana", "completed:false"},
		{"value": "banana", "completed:false"}
	],
	"completed": 1
}
			</p>
		</section>
		<section>
			<h4>Solution: Normalize the stata &amp; derive the data</h4>
		</section>
		<section>
			<h2>Redux: Reselect</h2>
			<p class="code">
let todos(state) => state.todos;

//Memoized
let completed = createSelector(todos, (todos) => {
	return todos.filter((todo) => todo.completed).length;
});
			</p>
		</section>
		<section>
			<h2>MobX</h2>
			<h4>
				Builds a dependency graph
				by tracking property access
			</h4>
		</section>
		<section>
			<h3>Automagic?</h3>
			<img src="img/automagic.gif" class="responsive halfscreen">
		</section>
		<section>
			<p class="code">
import {observable} from 'mobx';

var todoStore = observable({
    /* some observable state */
    todos: [],

    /* a derived value */
    get completedCount() {
        return this.todos.filter(todo => todo.completed).length;
    }
});
			</p>
		</section>
		<section>
			<p class="code">
import {autorun} from 'mobx';

/* a function that observes the state */
autorun(function() {
    console.log("Completed %d of %d items",
        todoStore.completedCount,
        todoStore.todos.length
    );
});
			</p>
		</section>
		<section>
			<p class="code">
/* ..and some actions that modify the state */
todoStore.todos[0] = {
    title: "banana",
    completed: false
};
// -> synchronously prints 'Completed 0 of 1 items'

todoStore.todos[0].completed = true;
// -> synchronously prints 'Completed 1 of 1 items'
			</p>
		</section>
		<section>
			<h3>Yea</h3>
			<img src="img/automagic.gif" class="responsive halfscreen">
		</section>
		<section>
			<h3>Debugger.html</h3>
			<p>The Firefox debugger written with Redux</p>
		</section>
		<section>
			<img src="img/thanks.gif" class="responsive fullscreen">
		</section>
		<section>
			<h2>Thanks!</h2>
		</section>
		<div class="progress"></div>
		<div class="controls">
			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="prev">
				<polygon points="0,10 20,20 20,0"/>
			</svg>
			<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="next">
				<polygon points="0,0 0,20 20,10"/>
			</svg>
		</div>
		<script src="dist/index.js"></script>
	</body>
</html>
